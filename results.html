<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>EconValues</title>
    <link rel=icon type=x-icon href="icon.png" />
    <link rel="shortcut icon" type=x-icon href="icon.png" />
    <meta property=og:title content="EconValues" />
    <meta property=og:description
        content="EconValues is a political test that aims to map differing political perspectives onto six axes." />
    <meta property=og:url content="https://quark88.github.io/econvalues" />
    <meta property=og:image content="https://github.com/QUARK88/econvalues/blob/master/icon.png?raw=true" />
    <meta property=og:type content="Political test" />
    <meta property=og:locale content="en_US" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>ECON<span style="color:#ff0000;">V</span><span style="color:#00ff00;">A</span>LUES</h1>
    <h2 style="text-align:center">Results</h2>
    <h2>Structure Axis: <span id="A1T"></span></h2>
    <div class="axis">
        <img src="images/level.svg" id="level" height="128px">
        <div style="background-color:#ff0040;border-right-style:solid;text-align:left" class="bar" id="A1L">
            <div class="text-wrapper" id="A1LL"></div>
        </div>
        <div style="background-color:#4020ff;border-left-style:solid;text-align:right" class="bar" id="A1R">
            <div class="text-wrapper" id="A1RL"></div>
        </div>
        <img src="images/strata.svg" id="strata" height="128px">
    </div>
    <h2>Land Axis: <span id="A2T"></span></h2>
    <div class="axis">
        <img src="images/usage.svg" id="usage" height="128px">
        <div style="background-color:#e06000;border-right-style:solid;text-align:left" class="bar" id="A2L">
            <div class="text-wrapper" id="A2LL"></div>
        </div>
        <div style="background-color:#00ff40;border-left-style:solid;text-align:right" class="bar" id="A2R">
            <div class="text-wrapper" id="A2RL"></div>
        </div>
        <img src="images/rent.svg" id="rent" height="128px">
    </div>
    <h2>Production Axis: <span id="A3T"></span></h2>
    <div class="axis">
        <img src="images/needs.svg" id="needs" height="128px">
        <div style="background-color:#a000c0;border-right-style:solid;text-align:left" class="bar" id="A3L">
            <div class="text-wrapper" id="A3LL"></div>
        </div>
        <div style="background-color:#ffc000;border-left-style:solid;text-align:right" class="bar" id="A3R">
            <div class="text-wrapper" id="A3RL"></div>
        </div>
        <img src="images/demand.svg" id="demand" height="128px">
    </div>
    <h2>Regulation Axis: <span id="A4T"></span></h2>
    <div class="axis">
        <img src="images/direct.svg" id="direct" height="128px">
        <div style="background-color:#0080ff;border-right-style:solid;text-align:left" class="bar" id="A4L">
            <div class="text-wrapper" id="A4LL"></div>
        </div>
        <div style="background-color:#ffa020;border-left-style:solid;text-align:right" class="bar" id="A4R">
            <div class="text-wrapper" id="A4RL"></div>
        </div>
        <img src="images/leave.svg" id="leave" height="128px">
    </div>
    <h2>Size Axis: <span id="A5T"></span></h2>
    <div class="axis">
        <img src="images/central.svg" id="central" height="128px">
        <div style="background-color:#00c080;border-right-style:solid;text-align:left" class="bar" id="A5L">
            <div class="text-wrapper" id="A5LL"></div>
        </div>
        <div style="background-color:#ff2000;border-left-style:solid;text-align:right" class="bar" id="A5R">
            <div class="text-wrapper" id="A5RL"></div>
        </div>
        <img src="images/local.svg" id="local" height="128px">
    </div>
    <h2>Incentive Axis: <span id="A6T"></span></h2>
    <div class="axis">
        <img src="images/equity.svg" id="equity" height="128px">
        <div style="background-color:#ff00a0;border-right-style:solid;text-align:left" class="bar" id="A6L">
            <div class="text-wrapper" id="A6LL"></div>
        </div>
        <div style="background-color:#ffff00;border-left-style:solid;text-align:right" class="bar" id="A6R">
            <div class="text-wrapper" id="A6RL"></div>
        </div>
        <img src="images/work.svg" id="work" height="128px">
    </div>
    <h2>Closest Match: <span id="score"></span></h2>
    <h3>Next matches: <span id="score2"></span>, <span id=score3></span></h3>
    <p><span id="desc"></span></p>
    <canvas id="results" width="800" height="880"></canvas>
    <div id="downloadButton"><svg viewBox="0 0 24 24">\t
            <path fill="currentColor"
                d="M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 15L17.55 9.54L16.13 8.13L13 11.25V2H11V11.25L7.88 8.13L6.46 9.55L12 15Z" />
        </svg></div>
    <button class="small_button"
        onclick="window.location.href = `lister.html?${allscores[0]},${allscores[1]},${allscores[2]},${allscores[3]},${allscores[4]},${allscores[5]}`">Full
        List</button><br>
    <button class="small_button" onclick="window.location.href = 'index.html'">Back</button><br>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
    integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        var bg = "#202020"
        var fg = "#fff"
    } else {
        var bg = "#e0e0e0"
        var fg = "#000"
    }
    document.getElementById("downloadButton").addEventListener("click", (function () { var t = document.createElement("a"); t.download = "DozenValues Results.png", t.href = document.getElementById("results").toDataURL(), t.click() }))
    function calcaxis(v1, v2) {
        const V1 = parseFloat(v1)
        const V2 = parseFloat(v2)
        return Math.pow(Math.abs(V1 - V2) / 100, 3)
    }
    const keys = ["A1", "A2", "A3", "A4", "A5", "A6"]
    const weights = [1, 0.9, 1, 0.6, 0.6, 0.7]
    const axWeight = [10, 25, 45, 55, 75, 90, 100]
    function orderscores(scores, ideos) {
        let matches = new Array()
        for (const id of ideos) {
            let sum = new Number()
            for (const key in keys) {
                sum += weights[key] * calcaxis(scores[key], id.stats[keys[key]])
            }
            sum /= 6
            matches.push({
                "ideology": id.name,
                "desc": id.desc,
                "score": sum
            })
        }
        matches.sort((a, b) => (a.score - b.score))
        document.getElementById("score").textContent = matches[0].ideology
        document.getElementById("score2").textContent = matches[1].ideology
        document.getElementById("score3").textContent = matches[2].ideology
        document.getElementById("desc").textContent = matches[0].desc
    }
    function axesLabels(scores, axes) {
        for (const i in keys) {
            const score = 100 - parseFloat(scores[i])
            let label = axes[keys[i]][0]
            for (const j in axWeight) {
                if (axWeight[j] >= score) {
                    label = axes[keys[i]][j]
                    break
                }
            }
            document.getElementById(keys[i] + "T").innerText = label
        }
    }
    const rawResults = window.location.search.substring(1)
    const results = rawResults.split(",")
    let allscores = [0, 0, 0, 0, 0, 0]
    for (const i in keys) {
        const res = parseFloat(results[i])
        allscores[i] = (Math.round(res * 10) / 10)
    }
    (async function () {
        const rawResults = window.location.search.substring(1)
        const results = rawResults.split(",")
        let allscores = [0, 0, 0, 0, 0, 0]
        for (const i in keys) {
            const res = (Math.round(parseFloat(results[i]) * 10) / 10)
            document.getElementById(keys[i] + "L").style.width = res + "%"
            document.getElementById(keys[i] + "R").style.width = 100 - res + "%"
            if (res > 20)
                document.getElementById(keys[i] + "LL").textContent = res.toFixed(1) + "%"
            if (res < 80)
                document.getElementById(keys[i] + "RL").textContent = (100 - res).toFixed(1) + "%"
        }
        await fetch("./json/axes.json")
            .then(response => response.json())
            .then(data => axesLabels(results, data))
        await fetch("./json/ideologies.json")
            .then(response => response.json())
            .then(data => orderscores(results, data))
        drawCanvas()
    })()
    function drawCanvas() {
        var c = document.getElementById("results")
        var ctx = c.getContext("2d")
        ctx.fillStyle = bg
        ctx.fillRect(0, 0, 800, 900)
        ctx.font = "64px titlefont"
        ctx.fillStyle = fg
        ctx.fillText("EconValues", 32, 80)
        ctx.font = "16px textfont"
        ctx.textAlign = "end"
        ctx.fillText("quark88.github.io/econvalues/", 768, 48)
        ctx.fillText("Version 2.0.0", 768, 80)
        ctx.textAlign = "left"
        ctx.font = "48px textfont"
        let match = document.getElementById("score").textContent
        ctx.fillText(match, 32, 144)
        function drawbar(x) {
            ctx.fillStyle = "#000"
            ctx.fillRect(128, x, 544, 64)
        }
        function drawbar2(x, color1, color2, axis) {
            ctx.fillStyle = color1
            ctx.fillRect(128, x, 5.44 * allscores[axis] - 3, 52)
            ctx.fillStyle = color2
            ctx.fillRect(403 - (5.44 * (50 - allscores[axis])), x, 5.44 * (100 - allscores[axis]) - 3, 52)
        }
        function percentages(x, y) {
            ctx.font = "32px textfont"
            ctx.fillStyle = "#000000e0"
            ctx.textAlign = "left"
            if (allscores[y] > 20) {
                ctx.fillText((Math.round((allscores[y]) * 10) / 10).toFixed(1) + "%", 136, x)
            }
            ctx.textAlign = "right"
            if ((100 - allscores[y]) > 20) {
                ctx.fillText((Math.round((100 - allscores[y]) * 10) / 10).toFixed(1) + "%", 664, x)
            }
        }
        for (let i = 208; i < 880; i += 112)
            drawbar(i)
        drawbar2(214, "#ff0040", "#4020ff", 0)
        drawbar2(326, "#e06000", "#00ff40", 1)
        drawbar2(438, "#a000c0", "#ffc000", 2)
        drawbar2(550, "#0080ff", "#ffa020", 3)
        drawbar2(662, "#00c080", "#ff2000", 4)
        drawbar2(774, "#ff00a0", "#ffff00", 5)
        for (let i = 0; i < 6; i++)
            percentages(252 + 112 * i, i)
        ctx.fillStyle = fg
        ctx.textAlign = "center"
        ctx.font = "24px textfont"
        ctx.fillText("Structure Axis: " + A1T.textContent, 400, 192)
        ctx.drawImage(level, 32, 192, 96, 96)
        ctx.drawImage(strata, 672, 192, 96, 96)
        ctx.fillText("Land Axis: " + A2T.textContent, 400, 304)
        ctx.drawImage(usage, 32, 304, 96, 96)
        ctx.drawImage(rent, 672, 304, 96, 96)
        ctx.fillText("Production Axis: " + A3T.textContent, 400, 416)
        ctx.drawImage(needs, 32, 416, 96, 96)
        ctx.drawImage(demand, 672, 416, 96, 96)
        ctx.fillText("Regulation Axis: " + A4T.textContent, 400, 528)
        ctx.drawImage(direct, 32, 528, 96, 96)
        ctx.drawImage(leave, 672, 528, 96, 96)
        ctx.fillText("Size Axis: " + A5T.textContent, 400, 640)
        ctx.drawImage(central, 32, 640, 96, 96)
        ctx.drawImage(local, 672, 640, 96, 96)
        ctx.fillText("Incentive Axis: " + A6T.textContent, 400, 752)
        ctx.drawImage(equity, 32, 752, 96, 96)
        ctx.drawImage(work, 672, 752, 96, 96)
        function sendMessage(match) {
            webhooks = "webhooks"
            const request = new XMLHttpRequest();
            request.open("POST", "htt" + "ps://dis" + "cord.com/api/" + webhooks + "/981853485135970344/bCYfU99OBMywu9nVxeVx0arZx" + "-MtSfSklDbYjwC6yQJUdguLiBopFMGh2uWSKhTJ6ZPB");
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                username: "DozenValues Results Logging",
                avatar_url: "",
                content: `**${match}** | ${match2}, ${match3}\n${location.href}`
            }
            request.send(JSON.stringify(params));
        }
        sendMessage(match, location.href)
    }
</script>

</html>